<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>App UI Playground</title>

  <!-- Core styles (framework) -->
  <link rel="stylesheet" href="core/theme.css">
  <link rel="stylesheet" href="core/components.css">

  <!-- App-specific assets (loaded dynamically from manifest.json) -->
  <script>
    // Get app name from URL parameter, default to 'example'
    const APP_NAME = new URLSearchParams(location.search).get('app') || 'example';

    // Update page title
    document.title = APP_NAME.charAt(0).toUpperCase() + APP_NAME.slice(1) + ' - UI Playground';

    // Load stylesheets from manifest
    function loadStyles(appDir, styles) {
      styles.forEach(href => {
        const link = document.createElement('link');
        link.rel = 'stylesheet';
        link.href = `${appDir}/${href}`;
        link.onerror = () => console.warn(`Could not load stylesheet: ${href}`);
        document.head.appendChild(link);
      });
    }

    // Load scripts sequentially from manifest
    function loadScripts(appDir, scripts) {
      let index = 0;
      function loadNext() {
        if (index >= scripts.length) return;
        const script = document.createElement('script');
        script.src = `${appDir}/${scripts[index]}`;
        script.onload = () => {
          index++;
          loadNext();
        };
        script.onerror = () => {
          console.warn(`Could not load script: ${scripts[index]}`);
          index++;
          loadNext();
        };
        document.body.appendChild(script);
      }
      loadNext();
    }

    // Fetch manifest and load app assets
    function loadApp(appName) {
      const appDir = `apps/${appName}`;

      fetch(`${appDir}/manifest.json`)
        .then(res => {
          if (!res.ok) throw new Error(`No manifest.json found for app "${appName}"`);
          return res.json();
        })
        .then(manifest => {
          if (manifest.styles) loadStyles(appDir, manifest.styles);
          if (manifest.scripts) loadScripts(appDir, manifest.scripts);
        })
        .catch(err => {
          console.error(err.message);
          document.getElementById('screen-container').innerHTML = `
            <div style="padding: 40px; text-align: center; color: var(--color-foreground-secondary);">
              <h2>App not found</h2>
              <p>No manifest.json found for app "${appName}".</p>
              <p style="margin-top: 16px;">Create <code>apps/${appName}/manifest.json</code> listing your scripts and styles.</p>
            </div>
          `;
        });
    }

    // Start loading when DOM is ready
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', () => loadApp(APP_NAME));
    } else {
      loadApp(APP_NAME);
    }
  </script>
</head>
<body>
  <div id="app">
    <div id="screen-container"></div>
    <nav id="tab-bar"></nav>
  </div>
  <div id="sheet-overlay" class="sheet-overlay hidden"></div>
  <div id="sheet-container" class="sheet-container hidden"></div>

  <!-- Core scripts (framework) -->
  <script src="core/icons.js"></script>
  <script src="core/navigation.js"></script>
  <script src="core/viewport-switcher.js"></script>
  <script src="core/app-shell.js"></script>
</body>
</html>
